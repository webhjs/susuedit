/**
 * @Description:
 * @Author bianpengfei
 * @create 2022/8/11 22:57
 */
const fs = require('fs')
const fsExtra = require('fs-extra')
const render = require('json-templater/string')
const path = require('path')
const endOfLine = require('os').EOL
const shell = require('shelljs')
const pkg = require('../package.json')
const { ROOT_PATH, LIB_OUTPUT} = require('./utils')

const OUTPUT_PATH = path.resolve(LIB_OUTPUT, 'example.html')

const MAIN_TEMPLATE = `

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="stylesheet" href="./BSE.css" />
    <title>电子病历编辑器示例</title>
  </head>
  <body>
    <!--  Author：bianpengfei Automatically generated by './build/build-lib-example-html.js'-->
    <div class="example"></div>
  </body>

  <script src="./BSE.umd.min.js"></script>
  <script>
    let instance = new window.BSE.Editor({ el: document.querySelector('.example'), height: '100vh' })
    console.log('打印编辑器实例：', instance)
    
    instance.on('loaded', () => {
      instance.setContent('测试')
    })
  </script>
</html>

`

const template = render(MAIN_TEMPLATE, {})

fs.writeFileSync(OUTPUT_PATH, template)

fsExtra.copySync(path.resolve(ROOT_PATH, 'public/@deprecated'), path.resolve(LIB_OUTPUT, '@deprecated'))

if (shell.exec(`prettier "${path.resolve(LIB_OUTPUT, 'example.html')}"  --config --ignore-unknown ./prettier.config.js --write`).code !== 0) {
  shell.exit(1)
}

console.log('[build entry] DONE:', OUTPUT_PATH)
